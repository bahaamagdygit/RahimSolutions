<div class="inbox-container">
  <h1 class="inbox-title">Inbox</h1>

  <div class="chat-wrapper">
    <!-- Left Sidebar - Contact List -->
    <div class="contacts-sidebar">
      <div class="sidebar-header">
        <h2>Chat</h2>
        <button class="search-btn">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
            <circle cx="11" cy="11" r="8"/>
            <path d="M21 21l-4.35-4.35"/>
          </svg>
        </button>
      </div>

      <div class="contacts-list">
        @for (contact of getFilteredContacts(); track contact.id) {
          <div
            class="contact-item"
            [class.active]="selectedContact()?.id === contact.id"
            (click)="selectContact(contact)">
            <div class="contact-avatar">
              @if (contact.avatar) {
                <img [src]="contact.avatar" [alt]="contact.name">
              } @else {
                <div class="avatar-initials" [attr.data-name]="contact.name">
                  {{ getInitials(contact.name) }}
                </div>
              }
              @if (contact.isOnline) {
                <span class="online-indicator"></span>
              }
            </div>
            <div class="contact-info">
              <h3 class="contact-name">{{ contact.name }}</h3>
              <p class="contact-last-message">{{ contact.lastMessage }}</p>
            </div>
            @if (contact.unreadCount > 0) {
              <span class="unread-badge">{{ contact.unreadCount }}</span>
            }
          </div>
        }
      </div>
    </div>

    <!-- Right Side - Chat Area -->
    <div class="chat-area">
      @if (selectedContact()) {
        <!-- Chat Header -->
        <div class="chat-header">
          <div class="chat-header-info">
            <div class="header-avatar">
              @if (selectedContact()!.avatar) {
                <img [src]="selectedContact()!.avatar" [alt]="selectedContact()!.name">
              } @else {
                <div class="avatar-initials">
                  {{ getInitials(selectedContact()!.name) }}
                </div>
              }
              @if (selectedContact()!.isOnline) {
                <span class="online-indicator"></span>
              }
            </div>
            <div class="header-text">
              <h2>{{ selectedContact()!.name }}</h2>
              <span class="status-text">Online 3 minutes ago</span>
            </div>
          </div>
          <div class="header-actions">
            <button class="action-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/>
                <path d="M13.73 21a2 2 0 0 1-3.46 0"/>
              </svg>
            </button>
            <button class="action-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="11" cy="11" r="8"/>
                <path d="M21 21l-4.35-4.35"/>
              </svg>
            </button>
            <button class="action-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <circle cx="12" cy="12" r="1"/>
                <circle cx="12" cy="5" r="1"/>
                <circle cx="12" cy="19" r="1"/>
              </svg>
            </button>
          </div>
        </div>

        <!-- Messages Area -->
        <div class="messages-area">
          @for (message of messages; track message.id) {
            <div class="message-wrapper" [class.sent]="message.isSent">
              @if (!message.isSent) {
                <div class="message-avatar">
                  @if (selectedContact()!.avatar) {
                    <img [src]="selectedContact()!.avatar" [alt]="selectedContact()!.name">
                  } @else {
                    <div class="avatar-initials small">
                      {{ getInitials(selectedContact()!.name) }}
                    </div>
                  }
                </div>
              }

              <div class="message-content-wrapper">
                @if (message.type === 'audio') {
                  <div class="message-bubble audio-message">
                    <button class="play-btn">
                      <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                        <polygon points="5 3 19 12 5 21 5 3"/>
                      </svg>
                    </button>
                    <div class="audio-waves">
                      <span></span><span></span><span></span><span></span><span></span>
                      <span></span><span></span><span></span><span></span><span></span>
                    </div>
                  </div>
                  <span class="message-time">{{ formatTime(message.timestamp) }}</span>
                }

                @if (message.type === 'text' && !message.images) {
                  <div class="message-bubble">
                    <p>{{ message.content }}</p>
                  </div>
                  <span class="message-time">{{ formatTime(message.timestamp) }}</span>
                }

                @if (message.type === 'image') {
                  <div class="message-with-images">
                    @if (message.content) {
                      <p class="image-caption">{{ message.content }}</p>
                    }
                    <div class="image-gallery">
                      @for (img of message.images; track img; let i = $index) {
                        @if (i < 3) {
                          <div class="gallery-image">
                            <img [src]="img" alt="Shared image">
                          </div>
                        }
                      }
                      @if (message.images && message.images.length > 3) {
                        <div class="gallery-image more-images">
                          <span>+{{ message.images.length - 3 }}</span>
                        </div>
                      }
                    </div>
                  </div>
                  <span class="message-time">{{ formatTime(message.timestamp) }}</span>
                }

                @if (message.type === 'file') {
                  <div class="message-bubble">
                    <div class="file-attachment">
                      <div class="file-icon">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="#e74c3c" stroke-width="2">
                          <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/>
                          <polyline points="14 2 14 8 20 8"/>
                        </svg>
                      </div>
                      <div class="file-info">
                        <span class="file-name">{{ message.fileName }}</span>
                        <span class="file-size">{{ message.fileSize }}</span>
                      </div>
                    </div>
                  </div>
                  <span class="message-time">{{ formatTime(message.timestamp) }}</span>
                }
              </div>

              @if (message.isSent) {
                <div class="message-avatar">
                  <img src="assts/imge/USER/USER.png" alt="You">
                </div>
              }
            </div>
          }
        </div>

        <!-- Message Input -->
        <div class="message-input-area">
          <div class="input-wrapper">
            <input
              type="text"
              placeholder="Type your message..."
              [ngModel]="newMessage()"
              (ngModelChange)="newMessage.set($event)"
              (keyup.enter)="sendMessage()">
            <button class="attach-btn">
              <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                <path d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48"/>
              </svg>
            </button>
          </div>
          <button class="send-btn" (click)="sendMessage()">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <line x1="22" y1="2" x2="11" y2="13"/>
              <polygon points="22 2 15 22 11 13 2 9 22 2"/>
            </svg>
          </button>
        </div>
      } @else {
        <div class="no-chat-selected">
          <p>Select a conversation to start chatting</p>
        </div>
      }
    </div>
  </div>
</div>
